# 항해 99 TIL - 2022.12.19

### 항해 99 TIL 일지

### Node.js 클론 코딩 주차

- 유튜브 클론 코딩 진행 중
- 동영상 업로드는 multer를 활용함
  - BE 서버가 EC2에서 작동하기 때문에 EC2에 동영상 파일을 임시 저장 시키고 S3로 업로드 시킨 후 삭제했다
  - MySQL은 S3에 저장된 파일 URL을 저장시킴
- 동영상 재생 문제
  - FE에서 S3에서 받아온 파일을 재생시키는게 아니고 다운로드 했다
  - FE에서 영상 재생 라이브러리를 따로 썼는데 호환성 이슈가 있는듯
  - S3에 저장시킬때 ContentDisposition: "inline"을 적용 시켜도 해결이 안됨
  - FE에서 'use strict' 부분을 없에주니 해결됐다
- 조회수 로직
  - 처음엔 cookie에 사용자 ip와 게시글 postId를 저장시켜 조회수 중첩을 못하게 막으려 했음
  - BE에서 쿠키를 보내주는것도 문제가 있었지만 사용자가 cookie를 제거해 조회수 악용을 할 수도 있고 쿠키 용량도 문제가 있었다
  - 조회수 로직은 후순위로 미뤄두긴 했지만 DB 테이블을 따로 만들어 ip주소와 게시글 저장시키는 방식으로 진행할 예정
- 동영상 압축
  - 유튜브처럼 마우스 올리면 확대 되면서 미리보기 재생이 가능하게 기능을 만들려 했다
  - 네트워크 부담을 줄이기 위해 미리보기는 압축된 영상으로 송출하는 것이 목표
  - S3에 올라간 파일을 압축해서 다시 올리는 것은 부족하다 여겨 화질별로 영상 압축을 해보려 했다
  - AWS의 MediaConverter와 영상 압축 코드 소스를 사용해 360p, 480p, 720p 영상을 따로 만들었다
  - 영상 파일은 HLS로 Adpative Bitrate Streaming이 가능한 형식
    - 클라이언트는 .m3u8 확장자를 가진 manifest 파일을 받음
    - manifest파일이 Bitrate에 맞는 청크를 재생함 (네트워크 상황에 따라 영상 화질 바뀜)
